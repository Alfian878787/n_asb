From 8cb6cdd8e2270eba5f5b1c3b6540f2da69a66ef4 Mon Sep 17 00:00:00 2001
From: Harish Mahendrakar <harish.mahendrakar@ittiam.com>
Date: Thu, 05 Oct 2017 14:18:26 +0530
Subject: [PATCH] SoftAVCDec: Handle zero length input without EOS

When a zero length input buffer is sent to SoftAVC decoder
without EOS set in nFlags, SoftAVC decoder plugin was
entering an infinite loop. Fixed it by returning from
onQueueFilled for such cases.

Bug: 66969349
Test: Tested using poc associated with the bug
Change-Id: I79cebc8f5b40c51256aba83a08deb547b220c4d7
(cherry picked from commit 21943c05f0ee2350647a6fa5ee17aa3c68859383)
---

diff --git a/media/libstagefright/codecs/avcdec/SoftAVCDec.cpp b/media/libstagefright/codecs/avcdec/SoftAVCDec.cpp
index cecc52b..1f47155 100644
--- a/media/libstagefright/codecs/avcdec/SoftAVCDec.cpp
+++ b/media/libstagefright/codecs/avcdec/SoftAVCDec.cpp
@@ -578,7 +578,7 @@
                 notifyEmptyBufferDone(inHeader);
 
                 if (!(inHeader->nFlags & OMX_BUFFERFLAG_EOS)) {
-                    continue;
+                    return;
                 }
 
                 mReceivedEOS = true;
